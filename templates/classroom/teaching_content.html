{% extends 'base.html' %}
{% load i18n %}

{% block content %}
<div class="mb-8">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-extrabold text-gray-800 dark:text-white">{% trans "Teaching Content" %}</h2>
    <a href="{% url 'create_exam' %}" class="px-6 py-3 bg-green-500 text-white rounded-xl font-bold hover:opacity-90 transition">
      <i class="fa-solid fa-plus mr-2"></i>{% trans "Create New Exam" %}
    </a>
  </div>

  <!-- My Exams List -->
  <div class="bg-surface rounded-2xl shadow-lg p-6">
    <h3 class="text-xl font-bold mb-4">{% trans "My Exams" %}</h3>
    
    {% if exams %}
    <div class="space-y-4">
      {% for exam in exams %}
      <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-xl hover:shadow-md transition">
        <div class="flex items-center justify-between">
          <div class="flex-grow">
            <div class="flex items-center gap-3 mb-2">
              <h4 class="text-lg font-bold">{{ exam.title }}</h4>
              {% if exam.is_ended %}
              <span class="px-2 py-1 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 text-xs rounded-full font-bold">
                <i class="fa-solid fa-ban mr-1"></i>{% trans "Ended" %}
              </span>
              {% elif exam.is_active %}
              <span class="px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs rounded-full font-bold">
                <i class="fa-solid fa-circle-check mr-1"></i>{% trans "Active" %}
              </span>
              {% else %}
              <span class="px-2 py-1 bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-gray-200 text-xs rounded-full font-bold">
                {% trans "Scheduled" %}
              </span>
              {% endif %}
              
              {% if exam.exam_type == 'multi_choice' %}
              <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs rounded-full font-bold">
                <i class="fa-solid fa-clipboard-question mr-1"></i>{% trans "Multiple Choice" %}
              </span>
              {% else %}
              <span class="px-2 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-xs rounded-full font-bold">
                <i class="fa-solid fa-code mr-1"></i>{% trans "Coding" %}
              </span>
              {% endif %}
            </div>
            
            <div class="flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400">
              {% if exam.start_time and exam.end_time %}
              <span>
                <i class="fa-solid fa-calendar mr-1"></i>{{ exam.start_time|date:"M d, H:i" }} - {{ exam.end_time|date:"M d, H:i" }}
              </span>
              {% elif exam.start_time %}
              <span>
                <i class="fa-solid fa-calendar mr-1"></i>{% trans "Starts" %}: {{ exam.start_time|date:"M d, H:i" }}
              </span>
              {% elif exam.end_time %}
              <span>
                <i class="fa-solid fa-calendar mr-1"></i>{% trans "Ends" %}: {{ exam.end_time|date:"M d, H:i" }}
              </span>
              {% else %}
              <span>
                <i class="fa-solid fa-infinity mr-1"></i>{% trans "Always Available" %}
              </span>
              {% endif %}
              <span>
                <i class="fa-solid fa-users mr-1"></i>{{ exam.submission_count }} {% trans "submissions" %}
              </span>
              <span>
                <i class="fa-sharp fa-solid fa-star text-yellow-400 mr-1"></i>{{ exam.points_value }} {% trans "stars" %}
              </span>
            </div>
            
            {% if exam.allowed_classes %}
            <div class="mt-2 flex items-center gap-2 text-xs">
              <span class="text-gray-600 dark:text-gray-400">{% trans "Classes" %}:</span>
              {% for class_name in exam.allowed_classes %}
              <span class="px-2 py-1 bg-primary/10 text-primary rounded-full">{{ class_name }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </div>
          
          <div class="flex gap-2">
            {% if exam.is_active and not exam.is_ended %}
            <button onclick="endExam({{ exam.id }})" 
              class="px-4 py-2 bg-red-500 text-white rounded-lg font-bold hover:bg-red-600 transition">
              <i class="fa-solid fa-stop mr-1"></i>{% trans "End Exam" %}
            </button>
            {% endif %}
            <a href="{% url 'teacher_exam_results' exam.id %}" 
              class="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:opacity-90 transition">
              <i class="fa-solid fa-chart-bar mr-1"></i>{% trans "View Results" %}
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12 text-gray-500">
      <i class="fa-solid fa-inbox text-6xl mb-4"></i>
      <p class="text-lg mb-4">{% trans "You haven't created any exams yet" %}</p>
      <a href="{% url 'create_exam' %}" class="inline-block px-6 py-3 bg-primary text-white rounded-xl font-bold hover:opacity-90 transition">
        <i class="fa-solid fa-plus mr-2"></i>{% trans "Create Your First Exam" %}
      </a>
    </div>
    {% endif %}
  </div>
</div>

<script>
function endExam(examId) {
  if (!confirm('{% trans "Are you sure you want to end this exam? Students will no longer be able to access it." %}')) {
    return;
  }
  
  fetch(`/teaching-content/end/${examId}/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': '{{ csrf_token }}',
      'X-Requested-With': 'XMLHttpRequest'
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      location.reload();
    } else {
      alert('{% trans "Error ending exam" %}');
    }
  })
  .catch(error => {
    alert('{% trans "Error ending exam" %}');
  });
}
</script>
{% endblock %}