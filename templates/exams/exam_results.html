{% extends 'base.html' %}
{% load i18n %}

{% block content %}
<div class="mb-6">
  <a href="{% url 'teaching_content' %}" class="inline-flex items-center text-primary hover:text-primary/80 font-bold mb-3">
    <i class="fa-solid fa-arrow-left mr-2"></i>
    {% trans "Back to Exams List" %}
  </a>
  <h2 class="text-2xl font-extrabold text-gray-800 dark:text-white">
    {{ exam.title }} - {% trans "Results" %}
  </h2>
</div>

<!-- Exam Info -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
  <div class="bg-surface p-4 rounded-xl shadow">
    <div class="text-sm text-gray-600 dark:text-gray-400">{% trans "Type" %}</div>
    <div class="text-xl font-bold">
      {% if exam.exam_type == 'multi_choice' %}
        <i class="fa-solid fa-clipboard-question mr-2"></i>{% trans "Multiple Choice" %}
      {% else %}
        <i class="fa-solid fa-code mr-2"></i>{% trans "Coding" %}
      {% endif %}
    </div>
  </div>
  
  <div class="bg-surface p-4 rounded-xl shadow">
    <div class="text-sm text-gray-600 dark:text-gray-400">{% trans "Submissions" %}</div>
    <div class="text-xl font-bold text-primary">{{ total_submissions }}</div>
  </div>
  
  <div class="bg-surface p-4 rounded-xl shadow">
    <div class="text-sm text-gray-600 dark:text-gray-400">{% trans "Avg Score" %}</div>
    <div class="text-xl font-bold text-primary">{{ avg_score|floatformat:1 }}</div>
  </div>
  
  <div class="bg-surface p-4 rounded-xl shadow">
    <div class="text-sm text-gray-600 dark:text-gray-400">{% trans "Max Stars" %}</div>
    <div class="text-xl font-bold text-yellow-500">{{ exam.points_value }} <i class="fa-sharp fa-solid fa-star text-yellow-400"></i></div>
  </div>
</div>

<!-- Submissions Table -->
<div class="bg-surface rounded-2xl shadow-lg overflow-hidden">
  <div class="p-6">
    <h3 class="text-xl font-bold mb-4">{% trans "Student Submissions" %}</h3>
    {% if submissions %}
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b border-gray-200 dark:border-gray-700">
            <th class="text-left py-3 px-4">{% trans "Rank" %}</th>
            <th class="text-left py-3 px-4">{% trans "Student" %}</th>
            <th class="text-left py-3 px-4">{% trans "Class" %}</th>
            <th class="text-left py-3 px-4">{% trans "Score" %}</th>
            <th class="text-left py-3 px-4">{% trans "Stars Earned" %}</th>
            <th class="text-left py-3 px-4">{% trans "Submitted At" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for submission in submissions %}
          <tr class="border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
            <td class="py-3 px-4">
              {% if forloop.counter == 1 %}
                <i class="fa-solid fa-medal text-yellow-400 text-xl"></i>
              {% elif forloop.counter == 2 %}
                <i class="fa-solid fa-medal text-gray-400 text-xl"></i>
              {% elif forloop.counter == 3 %}
                <i class="fa-solid fa-medal text-orange-400 text-xl"></i>
              {% else %}
                <span class="text-gray-500">#{{ forloop.counter }}</span>
              {% endif %}
            </td>
            <td class="py-3 px-4">
              <div class="font-bold">{{ submission.student.first_name }} {{ submission.student.last_name }}</div>
              <div class="text-sm text-gray-500">{{ submission.student.username }}</div>
            </td>
            <td class="py-3 px-4">
              <span class="px-2 py-1 bg-primary/10 text-primary rounded-full text-xs font-bold">
                {{ submission.student.student_class|default:"N/A" }}
              </span>
            </td>
            <td class="py-3 px-4">
              <div class="font-bold text-lg">{{ submission.score }}/{{ submission.total_questions }}</div>
              <div class="text-sm text-gray-500">{% widthratio submission.score submission.total_questions 100 %}%</div>
            </td>
            <td class="py-3 px-4">
              <span class="text-yellow-500 font-bold text-lg">
                {{ submission.stars_earned }} <i class="fa-sharp fa-solid fa-star text-yellow-400"></i>
              </span>
            </td>
            <td class="py-3 px-4 text-sm text-gray-600 dark:text-gray-400">
              {{ submission.submitted_at|date:"M d, Y H:i" }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center py-8 text-gray-500">
      <i class="fa-solid fa-inbox text-4xl mb-4"></i>
      <p>{% trans "No submissions yet" %}</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
